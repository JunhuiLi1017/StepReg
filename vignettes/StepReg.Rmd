---
title: "StepReg: Stepwise Regression make it simple"
author:
- name: Junhui Li
  affiliation: 
  - University of Massachusset Chan medical school, Worcester, USA
  - China Agricultural University, Beijing, China
- name: Kai Hu
  affiliation: University of Massachusset Chan medical school, Worcester, USA
- name: Xiaohuan Lu
  affiliation: Clark University, Worcester, USA
- name: Julie Lihua Zhu
  affiliation: University of Massachusset Chan medical school, Worcester, USA
- name: Wenxin Liu
  affiliation: China Agricultural University, Beijing, China
package: StepReg
output:
  BiocStyle::html_document:
    toc_float: true
  BiocStyle::pdf_document: default
abstract: |
  Stepwise regression is a widely employed data-mining technique aimed at identifying a valuable subset of predictors for utilization in a multiple regression model. To facilitate this process, we have developed the R package StepReg. This package empowers users to conduct linear, logistic, Poisson and Cox proportional hazard stepwise regression, incorporating popular selection criteria. It provides a versatile set of stop rules available in forward selection, backward elimination, both-direction, and best subset methods.

  With StepReg, users have the flexibility to specify effects to be included in all models and engage in multivariate multiple stepwise regression. The package is designed to streamline the modeling process, offering a range of options for effective variable selection, making it a valuable tool for researchers and analysts working with diverse datasets.
vignette: |
  %\VignetteIndexEntry{StepReg: Stepwise Regression made it simple}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Introduction

Here we applied the StepReg package to two well-known datasets, namely the mtcars, remission, lung, and CreditCard to provide clarity on the procedures for performing linear, logistic, Cox, and Poisson stepwise regression.

Here is a brief introduction for these four datasets.

The mtcars dataset is a classic automotive dataset that provides information on various car models and their performance attributes. With 32 observations and 11 variables, it includes details such as miles per gallon (mpg), horsepower, and the number of cylinders.

The remission dataset is relevant in the context of medical research, specifically in oncology. It captures data related to the remission status of leukemia patients. The dataset includes variables such as treatment type, white blood cell count, and remission status (1 for remission and 0 for non-remission). 

The lung dataset is a dataset in the survival analysis domain, containing information related to the survival times of 228 patients with advanced lung cancer. It includes variables such as the patient's age, the type of treatment received, and survival status.

The CreditCard dataset is associated with credit risk analysis and financial research. It contains information about credit card transactions, including details such as the amount spent, credit limit, and payment status. 

By applying the package to these datasets, we demonstrated the practical application of linear stepwise regression for continuous outcomes, logistic stepwise regression for binary outcomes, Cox stepwise regression for survival data and Poisson stepwise regression for count data. Through these examples, users can gain insights into how StepReg can be effectively utilized for variable selection in different regression scenarios. Thees datasets, being well-established and diverse in nature, provide robust test cases for showcasing the capabilities and versatility of the StepReg package in real-world applications.

# Examples

```{r library}
library(StepReg)
```

## linear stepwise regression with data mtcar

### perform linear stepwise regression using the 'forward' strategy for variable selection and 'AIC' as the criteria for stop rules, you can follow the code below:
```{r}
data(mtcars)
formula <- mpg ~ .
sForwAIC <- stepwise(formula = formula,
         data = mtcars,
         type = "linear",
         strategy = "forward",
         metric = "AIC")
sForwAIC
```

From the above result, we can see that stepwise() output a list with 5 tables. 

* Table 'Summary of Parameters' tells you what parameters are used for this function. Especially, except basic information of paramters, it will also indicate 1) if there is any variable included in all models, 2) if a multicollinearity variable will be detected, 3) if "intercept" equals 1, it indicates that this stepwise regression includes an intercept, otherwise, if it equals 0, the regression does not include an intercept.

* 'Variables Type' is the summary detailing the type of all variables.

* "Process of Selection" provides insights into how variables are chosen. In this instance, the last column displays the corresponding AIC values which is servesd as the criterion. Remember that variable selection based on AIC involves a trade-off between model fit and complexity, and it's essential to interpret the selected model cautiously.

* "Coefficients of the Selected Variables" presents the coefficients associated with all selected variables.

### Conduct linear stepwise regression employing the 'bidirection' strategy with 'SL' as stopping criterion, and set the significance level for entry (sle) to 0.15 and the significance level for stay (sls) to 0.15.

```{r}
formula <- mpg ~ .
sBidiSL <- stepwise(formula = formula,
         data = mtcars,
         type = "linear",
         strategy = "bidirection",
         metric = "SL",
         sle = 0.15,
         sls = 0.15)
sBidiSL
```

The output of this time is similar to the last time except that the last column name of 'Process of Selection' is SL.

### Perform linear stepwise regression using the 'backward' method for variable selection, employing 'SBC' as the criteria for stop rules, and excluding the intercept in the stepwise regression.

```{r}
formula <- mpg ~ . + 0
sBackSBC <- stepwise(formula = formula,
                     data = mtcars,
                     type = "linear",
                     strategy = "backward",
                     metric = "SBC")
sBackSBC
```

Note that 0 is displayed instead of 1 in the 'Summary of Parameters' and 'Selected Variables' tables.

### Conduct linear stepwise regression using the 'subset' strategy for variable selection with 'AICc' as the criteria. Perform multivariable multiple stepwise regression with 'mpg' and 'dra' as dependent variables. Additionally, use 'cyl', 'disp', 'hp', 'wt', 'vs', and 'am' as independent variables, where 'wt' is consistently included in all models.
 
```{r}
formula <- cbind(mpg,drat) ~ cyl + disp + hp + wt + vs + am
stepwise(formula = formula,
        data = mtcars,
        type = "linear",
        include = 'wt',
        strategy = "subset",
        metric = "AICc",
        best_n = 3)
```

## logistic stepwise regression with data remission

The remission data, taken from Lee (1974), consist of patient characteristics and whether or not cancer remission occurred, and are saved in the data set remission. The variable remiss is the cancer remission indicator variable with a value of 1 for remission and a value of 0 for nonremission.  The other six variables are the risk factors thought to be related to cancer remission.

### Perform logistic stepwise regression using the 'forward' method for variable selection with 'AIC' as the criteria for stop rules.

```{r warning = FALSE}
data(remission)
formula <- remiss ~ .
stepwise(formula = formula,
         data = remission,
         type = "logit",
         strategy = "forward",
         metric = "AIC")
```

### Conduct logistic stepwise regression using the 'subset' method for variable selection with 'SL' as the criteria.

```{r warning = FALSE}
data(remission)
formula <- remiss ~ .
stepwise(formula = formula,
         data = remission,
         type = "logit",
         strategy = "subset",
         metric = "SL",
         best_n = 3)
```

## Cox stepwise regression with data lung

### Perform Cox stepwise regression using the 'forward' method for variable selection with 'IC(1)' as the criteria for stop rules.

```{r warning = FALSE}
lung <- survival::lung
my.data <- na.omit(lung)
my.data$status1 <- ifelse(my.data$status == 2,1,0)
formula  =  Surv(time, status1) ~ . - status 

stepwise(formula = formula,
            data = my.data,
            type = "cox",
            strategy = "forward",
            metric = "IC(1)")
```

### Conduct Cox stepwise regression using the 'bidirection' method for variable selection with 'SL' as the criteria. 

```{r warning = FALSE}
formula = Surv(time, status1) ~ . - status 
stepwise(formula = formula,
         data = my.data,
         type = "cox",
         strategy = "bidirection",
         metric = "SL",
         sle = 0.05,
         sls = 0.05)
```

## Poisson stepwise regression with data CreditCard

### Perform Poisson stepwise regression using the 'forward' method for variable selection with 'AIC' as the criteria for stop rules.

```{r warning = FALSE}
data(CreditCard, package = 'AER')
formula  = reports ~ .

stepwise(formula = formula,
            data = CreditCard,
            type = "poisson",
            strategy = "forward",
            metric = "AIC")
```

```{r warning = FALSE}
formula = reports ~ .
stepwise(formula = formula,
         data = CreditCard,
         type = "poisson",
         strategy = "bidirection",
         metric = "SL",
         sle = 0.05,
         sls = 0.05)
```

# Session Info
```{r sessionInfo, echo = FALSE}
sessionInfo()
```
